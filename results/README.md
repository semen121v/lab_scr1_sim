Выполнил: студент группы Р41193 Кравцов Семен Денисович

Лабораторная работа №2. SCR1

|Вар.	|   Вид исключения	|   Тест	|   Reset Vector	|   Trap Vector     |	При обработке
|------ | -----------       |------     | -----------       |------             | -----------
|├─3	|   Breakpoint      | isa/rv32mi/sbreak.S |  0x1000 | 0x840             |  BP

Цель:

Ознакомиться с возможностями настройки архитектуры системы команд, обработкой исключений/прерываний и принципами работы сборщика программ.
**Работа выполнялась  на виртуальной машине в ОС Ubuntu.
## Выполнение:
1. Был создан репозиторий проекта, в него скопирована master-ветка проекта scr1. Название новой ветки lab_scr1_sim.
2. Загрузка тестов:
    i. Был скачан проект, RISCV GCC скачан с сайта Syntacore, RISC-V ISA, RISC-V Compliance и Coremark тесты.
    ii. В переменную среды PATH была добавлена ссылка на исполняемые файлы gcc, а так же RISCV_TESTS и RISCV_COMPLIANCE_TESTS.
    iii.При запуске из командной строки start-sh.cmd команды make run_modelsim была получена ошибка.  
    iv. Была произведена сборка Verilator с git для версии 4.012. Тем не менее, ошибка при запуске тестов повторилась.
    v. При помощи команды sudo ln -s /usr/lib/x86_64-linux-gnu/libmpfr.so.6 /usr/lib/x86_64-linux-gnu/libmpfr.so.4 проблему удалось решить.  
3.  запуск тестов:
Тесты успешно прошли при запуске в терминале Ubuntu на версии Verilator 4.012. Запуск производился в конфигурации по умолчанию при помощи команды make run_verilator.
4. В файле ./src/includes/scr1_arch_description.svh параметр SCR1_TRACE_LOG_FULL был помещён в комментарии.
5. Для того, чтобы при симуляции запускался лишь тест, указанный в задании были изменены два файла:
    i.В .Makefile закоменнтированые все тесты в строказ с 85 по 100 кроме строки TARGETS += riscv_isa.
    ii.В файле scr1/sim/tests/riscv_isa/rv32_tests.inc строки с 5 по 63 были заменены на rv32_isa_tests += isa/rv32mi/sbreak.S.
6. Симуляция была запущена заново, теперь тест исполняется лишь один, указанный в задании.  
7. В файле ./sim/tests/common/riscv_macros.h была модифицирована обработка исключений trap_vector. Добавлена проверка исключения "Breakpoint".
8. Для вывода строки "BP" в консоль изменён файл ./sim/tests/common/riscv_macros.h в строках 126 - 128 добавлены макросы для печати "BP" : PRINT_CHAR('B');  PRINT_CHAR('P'); \ PRINT_CHAR('\n');.
9. В файле ./src/includes/scr1_arch_description.svhв строках 130 и 131 значения параметров SCR1_ARCH_RST_VECTOR и  CR1_ARCH_CSR_MTVEC_BASE изменены на 'h1000' и 'h840' соответственно.
10. В файле ./sim/tests/common/link.ld в строке 29 значение адреса изменено с 0x100 на 0x840;
11. В корневой директории проекта создана директория results с файлами test_results.txt (результат симуляции), *.dump (дизассемблер теста ), trace_mprf_diff_.log (трейс лог MPRF), trace_csr_.lo (трейс лог CSR) и README.md для составления отчета.
12. В файле README.md составлен отчёт.
## Выводы:
1. В ходе данной работы были освоены навыки работы с Ubuntu на Virtual machine.
2. Симуляция проекта происходит в Verilator в ходе выполнения программы на System Verilog. Тесты на C и RISCV ассемблере компилируются при помощи gcc в hex представление и загружаются на исполнение в .sv testbench.

    